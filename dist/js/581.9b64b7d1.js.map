{"version":3,"file":"js/581.9b64b7d1.js","mappings":"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","sources":["webpack://frontend/./src/views/validacionView.vue","webpack://frontend/./src/views/validacionView.vue?3905"],"sourcesContent":["<template>\n  <div>\n    <section class=\"hero \" v-if=\"estado == 'pending' || estado == 'failure'\">\n      <div class=\"container mt-5\">\n        <!-- Hero Content-->\n        <div class=\"hero-content pb-5 text-center\">\n          <h3 class=\"mb-5\">Pago incorrecto</h3>\n          <div class=\"row\">  \n            <p class=\"lead mb-0\">As am hastily invited settled at limited civilly fortune me. \n                Really spring in extent an by. Judge but built party world. Of so am he remember\n                 although required. Bachelor unpacked be advanced at. Confined in declared \n                 marianne is vicinity. </p>\n                </div> \n          </div>\n        </div>\n</section>\n<section class=\"hero\" v-if=\"!msn_error\">\n      <div class=\"container mt-5\" v-if=\"pago.status == 'approved'\">\n        <!-- Hero Content-->\n        <div class=\"hero-content pb-5 text-center\">\n          <h3 class=\"mb-5\">Validando pago...</h3>\n          <div class=\"row\">   \n            <div class=\"col-xl-8 offset-xl-2\">\n              <img src=\"../../public/assets/img/loadingPay.gif\" style=\"width: 80px;\">\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"container mt-5\" v-if=\"msn_error\">\n        <!-- Hero Content-->\n        <div class=\"hero-content pb-5 text-center\">\n          <h3 class=\"mb-5\">{{msn_error}}</h3>\n          <div class=\"row\">   \n            <div class=\"col-xl-8 offset-xl-2\">\n              <p class=\"lead mb-0\">Consulta con tu banco detalles del pago declinado</p>\n          </div>\n        </div>\n      </div>\n    </div>\n</section>\n  </div>\n</template>\n<script>\nimport axios from 'axios'\nimport { registerRuntimeCompiler } from 'vue'\nexport default{\n  name: 'validacionView',\n  data(){\n    return{\n      estado:'',\n      payment_id: '',\n      pago:{},\n      direccion: '',\n      msn_error: '',\n      venta: {},\n      detalles: [],\n      total: 0,\n      carrito: [],\n      envio: 1\n    }\n  },\n  beforeMount(){\n    this.estado = this.$route.params.estado \n    this.payment_id = this.$route.query.payment_id\n\n    let user_data = JSON.parse(this.$store.state.user)\n    this.init_carrito()\n\n    this.venta.transaccion = this.payment_id\n    this.venta.envio = this.envio\n    this.venta.cliente = user_data._id\n    if(this.$route.params.direccion){\n    this.direccion = this.$route.params.direccion\n    this.venta.direccion = this.direccion\n    }else{\n      this.msn_error = 'No se obtuvo el codigo de la direccion'\n    }\n    this.init_payment(this.payment_id)\n  },\n  methods:{\n    init_carrito() {\n      this.total = 0\n        axios.get(this.$url + \"/obtener_carrito\", {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: this.$store.state.token,\n          },\n        })\n        .then((result) => {\n          console.log(result.data.cart_general)\n          this.n_productos = result.data.cart_general.length\n          for(var item of result.data.cart_general){\n            let subtotal = item.producto.precio * item.cantidad\n            this.total = this.total + subtotal \n            this.detalles.push({\n              subtotal: subtotal,\n              precio_unida: item.producto.precio,\n              cantidad: item.cantidad,\n              cliente: this.venta.cliente,\n              producto: item.producto._id,\n              variedad: item.variedad._id\n            })\n          }\n          this.venta.total = this.total\n          this.carrito = result.data.cart_general\n          \n        }); \n    },\n    validad_venta(payment_id){\n        axios.get(this.$url+'/validar_payment_id_venta/'+this.payment_id,{\n          headers:{\n          'Content-Type': 'application/json',\n          'Authorization': this.$store.state.token\n        }\n        }).then((result)=>{\n          if(result.data.length >= 1){\n            this.msn_error = 'El pago ya fue asignado a otra venta'\n          }else if(result.data.length == 0){\n            this.crear_compras()\n          }\n        })\n    },\n    crear_compras(){\n      this.venta.detalles = this.detalles\n      axios.post(this.$url+'/crear_venta_cliente',this.venta,{\n          headers:{\n          'Content-Type': 'application/json',\n          'Authorization': this.$store.state.token\n        }\n        }).then((result)=>{\n          this.$socket.emit('send_cart',true)\n          this.$router.push({name: 'venta_detalle',params:{id:result.data.id}})\n        })\n    },\n    init_payment(payment_id){\n        axios.get('https://api.mercadopago.com/v1/payment/'+payment_id,{\n          headers:{\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer TEST-7802715175959909-050803-6580fa6051eed313c72af5b01407940f-2426338693'\n        }\n        }).then((result)=>{\n          console.log(result.data)\n          this.pago = result.data\n          if(this.pago.status == 'approved'){\n            this.validar_venta(this.payment_id)\n          }else{\n            this.msn_error = 'El pago no fue aprovado'\n          }\n        })\n    }\n  }\n}\n</script>\n","import { render } from \"./validacionView.vue?vue&type=template&id=8a966164\"\nimport script from \"./validacionView.vue?vue&type=script&lang=js\"\nexport * from \"./validacionView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","estado","msn_error","pago","status","name","data","payment_id","direccion","venta","detalles","total","carrito","envio","beforeMount","this","$route","params","query","user_data","JSON","parse","$store","state","user","init_carrito","transaccion","cliente","_id","init_payment","methods","axios","get","$url","headers","Authorization","token","then","result","item","console","log","cart_general","n_productos","length","subtotal","producto","precio","cantidad","push","precio_unida","variedad","validad_venta","crear_compras","post","$socket","emit","$router","id","validar_venta","__exports__","render"],"sourceRoot":""}