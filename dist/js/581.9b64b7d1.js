"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[581],{3254:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var i=a(641),o=a(33),s=a.p+"img/loadingPay.06e9771d.gif";const n={key:0,class:"hero"},r={key:1,class:"hero"},d={key:0,class:"container mt-5"},c={key:1,class:"container mt-5"},l={class:"hero-content pb-5 text-center"},h={class:"mb-5"};function p(t,e,a,p,v,u){return(0,i.uX)(),(0,i.CE)("div",null,["pending"==v.estado||"failure"==v.estado?((0,i.uX)(),(0,i.CE)("section",n,e[0]||(e[0]=[(0,i.Fv)('<div class="container mt-5"><div class="hero-content pb-5 text-center"><h3 class="mb-5">Pago incorrecto</h3><div class="row"><p class="lead mb-0">As am hastily invited settled at limited civilly fortune me. Really spring in extent an by. Judge but built party world. Of so am he remember although required. Bachelor unpacked be advanced at. Confined in declared marianne is vicinity. </p></div></div></div>',1)]))):(0,i.Q3)("",!0),v.msn_error?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("section",r,["approved"==v.pago.status?((0,i.uX)(),(0,i.CE)("div",d,e[1]||(e[1]=[(0,i.Fv)('<div class="hero-content pb-5 text-center"><h3 class="mb-5">Validando pago...</h3><div class="row"><div class="col-xl-8 offset-xl-2"><img src="'+s+'" style="width:80px;"></div></div></div>',1)]))):(0,i.Q3)("",!0),v.msn_error?((0,i.uX)(),(0,i.CE)("div",c,[(0,i.Lk)("div",l,[(0,i.Lk)("h3",h,(0,o.v_)(v.msn_error),1),e[2]||(e[2]=(0,i.Lk)("div",{class:"row"},[(0,i.Lk)("div",{class:"col-xl-8 offset-xl-2"},[(0,i.Lk)("p",{class:"lead mb-0"},"Consulta con tu banco detalles del pago declinado")])],-1))])])):(0,i.Q3)("",!0)]))])}var v=a(4335),u={name:"validacionView",data(){return{estado:"",payment_id:"",pago:{},direccion:"",msn_error:"",venta:{},detalles:[],total:0,carrito:[],envio:1}},beforeMount(){this.estado=this.$route.params.estado,this.payment_id=this.$route.query.payment_id;let t=JSON.parse(this.$store.state.user);this.init_carrito(),this.venta.transaccion=this.payment_id,this.venta.envio=this.envio,this.venta.cliente=t._id,this.$route.params.direccion?(this.direccion=this.$route.params.direccion,this.venta.direccion=this.direccion):this.msn_error="No se obtuvo el codigo de la direccion",this.init_payment(this.payment_id)},methods:{init_carrito(){this.total=0,v.A.get(this.$url+"/obtener_carrito",{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{for(var e of(console.log(t.data.cart_general),this.n_productos=t.data.cart_general.length,t.data.cart_general)){let t=e.producto.precio*e.cantidad;this.total=this.total+t,this.detalles.push({subtotal:t,precio_unida:e.producto.precio,cantidad:e.cantidad,cliente:this.venta.cliente,producto:e.producto._id,variedad:e.variedad._id})}this.venta.total=this.total,this.carrito=t.data.cart_general}))},validad_venta(t){v.A.get(this.$url+"/validar_payment_id_venta/"+this.payment_id,{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{t.data.length>=1?this.msn_error="El pago ya fue asignado a otra venta":0==t.data.length&&this.crear_compras()}))},crear_compras(){this.venta.detalles=this.detalles,v.A.post(this.$url+"/crear_venta_cliente",this.venta,{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((t=>{this.$socket.emit("send_cart",!0),this.$router.push({name:"venta_detalle",params:{id:t.data.id}})}))},init_payment(t){v.A.get("https://api.mercadopago.com/v1/payment/"+t,{headers:{"Content-Type":"application/json",Authorization:"Bearer TEST-7802715175959909-050803-6580fa6051eed313c72af5b01407940f-2426338693"}}).then((t=>{console.log(t.data),this.pago=t.data,"approved"==this.pago.status?this.validar_venta(this.payment_id):this.msn_error="El pago no fue aprovado"}))}}},m=a(6262);const _=(0,m.A)(u,[["render",p]]);var g=_}}]);
//# sourceMappingURL=581.9b64b7d1.js.map