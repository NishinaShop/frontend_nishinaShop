<template>
  <div>
    <section id="hero" class="top-header">
      <div class="container">
        <div class="space-between-block">
          <div class="w-layout-hflex horizontal-left-center-35px-gap">
            <div class="w-layout-hflex icon-list-10px-gap">
              <img
                src="../assets/img/66bf2986a87268259b6529db_Frame (1).svg"
                loading="lazy"
                alt=""
                class="image-24px"
              />
              <p class="_14px-text-white">
                Envios gratis en compras mayores a $899
              </p>
            </div>
            <div class="w-layout-hflex icon-list-10px-gap">
              <img
                src="../assets/img/66bf2986cdd4f45da9d903db_Frame (2).svg"
                loading="lazy"
                alt=""
                class="image-24px"
              />
              <p class="_14px-text-white">
                10% de descuento en tu primera compra
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div
      data-animation="default"
      class="navbar w-nav"
      data-easing2="ease"
      data-easing="ease"
      data-collapse="medium"
      data-w-id="6999f335-005a-f68f-bf29-0723f291d072"
      role="banner"
      data-duration="400"
      id="navbar"
    >
      <nav class="container">
        <div class="navbar-wrapper">
          <a
            href="/index.html"
            aria-current="page"
            class="site-logo-wrapper-in-tablet w-nav-brand w--current"
            aria-label="Inicio"
          >
            <img
              src="../assets/img/nishina-logo.png"
              loading="lazy"
              width="70"
              alt=""
              class="site-logo"
            />
          </a>
          <div class="horizontal-left-center-10px-gap hide-in-tablet">
            <a
              href="http://facebook.com/"
              target="_blank"
              class="social-icon-navbar w-inline-block"
            >
              <img
                src="../assets/img/66bf1affbc25c2a233add783_Frame.svg"
                loading="lazy"
                alt=""
                class="_16px-image"
              />
            </a>
            <a
              href="https://twitter.com/"
              target="_blank"
              class="social-icon-navbar w-inline-block"
            >
              <img
                src="../assets/img/66bf1affb8d2ed54148f31c9_Frame (1).svg"
                loading="lazy"
                alt=""
                class="_16px-image"
              />
            </a>
            <a
              href="https://pinterest.com/"
              target="_blank"
              class="social-icon-navbar w-inline-block"
            >
              <img
                src="../assets/img/66bf1affe7f986070197a33d_Frame (2).svg"
                loading="lazy"
                alt=""
                class="_16px-image"
              />
            </a>
            <a
              href="https://www.linkedin.com/"
              target="_blank"
              class="social-icon-navbar w-inline-block"
            >
              <img
                src="../assets/img/66bf1aff088665226d183130_Frame (3).svg"
                loading="lazy"
                alt=""
                class="_16px-image"
              />
            </a>
          </div>
          <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
            <div class="nav-middle-wrapper">
              <ul role="list" class="nav-menu w-list-unstyled">
                <li
                  data-w-id="4ef02e47-0ea5-5857-a6ac-bbd1e53c8b90"
                  class="nav-list"
                >
                  <router-link class="nav-link w--current" to="/"
                    >Inicio</router-link
                  >
                </li>
                <li class="nav-list">
                  <router-link class="nav-link" to="/catalogo">
                    Catalogo
                  </router-link>
                </li>
                <li class="nav-list-for-dropdown">
                  <div class="nav-icon-and-text-wrapper">
                    <a href="/index.html" class="nav-link"> Temporada </a>
                  </div>
                </li>
              </ul>
              <a
                href="/index.html"
                aria-current="page"
                class="site-logo-wrapper-hide-in-mobile w-nav-brand w--current"
                aria-label="home"
              >
                <img
                  src="../assets/img/nishina-logo.png"
                  loading="lazy"
                  width="150"
                  alt=""
                  class="img-fluid"
                />
              </a>
              <ul role="list" class="nav-menu w-list-unstyled">
                <li
                  data-w-id="dc0d01a4-7c09-7606-9f50-dd1e1319b401"
                  class="nav-list"
                >
                  <div class="nav-icon-and-text-wrapper">
                    <a href="/index.html" class="nav-link"> Nosotros </a>
                  </div>
                </li>
                <li
                  data-w-id="dc0d01a4-7c09-7606-9f50-dd1e1319b435"
                  class="nav-list"
                >
                  <div class="nav-icon-and-text-wrapper">
                    <a href="/index.html" class="nav-link"> Mayoristas </a>
                  </div>
                </li>
                <li
                  data-w-id="d573f299-6765-7c8a-59e7-139abc7be21c"
                  class="nav-list"
                >
                  <div class="nav-icon-and-text-wrapper">
                    <a href="/index.html" class="nav-link"> Contacto </a>
                  </div>
                </li>
              </ul>
              <div class="show-in-tablet">
                <div class="horizontal-left-center-10px-gap">
                  <a
                    href="http://facebook.com/"
                    target="_blank"
                    class="social-icon-navbar w-inline-block"
                  >
                    <img
                      src="../assets/img/66bf1affbc25c2a233add783_Frame.svg"
                      loading="lazy"
                      alt=""
                      class="_16px-image"
                    />
                  </a>
                  <a
                    href="https://twitter.com/"
                    target="_blank"
                    class="social-icon-navbar w-inline-block"
                  >
                    <img
                      src="../assets/img/66bf1affb8d2ed54148f31c9_Frame (1).svg"
                      loading="lazy"
                      alt=""
                      class="_16px-image"
                    />
                  </a>
                  <a
                    href="https://pinterest.com/"
                    target="_blank"
                    class="social-icon-navbar w-inline-block"
                  >
                    <img
                      src="../assets/img/66bf1affe7f986070197a33d_Frame (2).svg"
                      loading="lazy"
                      alt=""
                      class="_16px-image"
                    />
                  </a>
                  <a
                    href="https://www.linkedin.com/"
                    target="_blank"
                    class="social-icon-navbar w-inline-block"
                  >
                    <img
                      src="../assets/img/66bf1aff088665226d183130_Frame (3).svg"
                      loading="lazy"
                      alt=""
                      class="_16px-image"
                    />
                  </a>
                </div>
              </div>
            </div>
          </nav>
          <div class="nav-icons">
            <!-- Search 
          <div class="search-icon-wrapper">
              <img
                src="../assets/img/66bf2b44bcf606ad88fddad8_Search.svg"
                loading="lazy"
                data-w-id="cd8ab261-2094-66af-a8c2-ba1d646cb0ca"
                alt=""
                class="image-24px-icon"
              />
              <div
                data-w-id="8ddcb4bf-6bc4-b62c-c129-29ad15f847d7"
                class="popup-search-bar"
                style="
                  transform: translate3d(0px, 50px, 0px) scale3d(1, 1, 1)
                    rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg);
                  transform-style: preserve-3d;
                  display: none;
                  opacity: 0;
                "
              >
                <form
                  action="https://trendy-tnc.webflow.io/search"
                  class="search-input w-form"
                >
                  <input
                    class="form-input-field w-input"
                    maxlength="256"
                    name="query"
                    placeholder="Searchâ€¦"
                    type="search"
                    id="search"
                    required=""
                  />
                  <input
                    type="submit"
                    class="search-icon-button w-button"
                    value="search"
                  />
                </form>
              </div>
            </div> -->
            <div class="nav-item dropdown"><router-link class="navbar-icon-link d-lg-none" to="/detalles_carrito"> 
              <img src="../../public/assets/index_files/66bf2a3553dec5e95df2d69c_bag.svg" alt="Carrito de compras" class="img-icon">
              <span class="text-sm ms-2 ms-lg-0 text-uppercase text-sm fw-bold d-none d-sm-inline d-lg-none">Ver carrito</span></router-link>
                <div class="d-none d-lg-block"><a class="navbar-icon-link" id="cartdetails" href="cart.html" data-bs-target="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <img src="../../public/assets/index_files/66bf2a3553dec5e95df2d69c_bag.svg" alt="Carrito de compras" class="img-icon">
                    <div class="navbar-icon-link-badge">{{ count_cart }}                       </div></a>
                  <div class="dropdown-menu dropdown-menu-animated dropdown-menu-end p-4" aria-labelledby="cartdetails">
                    <div class="navbar-cart-product-wrapper">
                      <!-- cart item-->
                      <div class="navbar-cart-product" v-for="item in carrito"> 
                        <div class="d-flex align-items-center"><a><img class="img-fluid navbar-cart-product-image" :src="$url+'/obtener_portada_producto/'+item.producto.portada" alt="..."></a>
                          <div class="w-100"><a class="navbar-cart-product-close" href="#"><i class="fa fa-times">                                                   </i></a>
                            <div class="ps-3"> <router-link class="navbar-cart-product-link" :to="{name: 'detalles_producto',params:{slug: item.producto.slug}}">{{item.producto.nombre}}</router-link>
                              <small class="d-block text-muted">{{item.variedad.color+'-'+item.variedad.talla}}</small>
                              <small class="d-block text-muted">Cantidad: {{item.cantidad}} </small>
                              <strong class="d-block text-sm text-end">{{convertCurrency(item.producto.precio * item.cantidad)}} </strong></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- total price-->
                    <div class="navbar-cart-total"><span class="text-uppercase text-muted">Tota:</span><strong class="text-uppercase">{{ convertCurrency(total) }}</strong></div>
                    <!-- buttons-->
                    <div class="d-flex justify-content-between"><router-link class="btn btn-link text-dark me-3" to="/detalles_carrito">Ver carrito<i class="fa-arrow-right fa"></i></router-link><router-link class="btn btn-outline-dark" :to="{name: 'pago_carrito'}">Checkout</router-link></div>
                  </div>
                </div>
              </div>
            <router-link
              class="w-inline-block"
              to="/login"
              v-if="!$store.state.token"
            >
              <img
                src="../assets/img/66bf2b432404d408024dcb53_Frame.svg"
                loading="lazy"
                alt=""
                class="image-24px"
              />
              <span class="w-inline-block">Ingresar</span>
            </router-link>
            <a
              class="w-inline-block dropdown"
              to="/login"
              v-if="$store.state.token"
            >
              <img
                src="../assets/img/66bf2b432404d408024dcb53_Frame.svg"
                loading="lazy"
                alt=""
                class="image-24px"
              />
              <span class="w-inline-block dropdown-toggle" data-bs-target="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> &nbsp; {{ user.nombre.split(" ")[0] }}</span>
              <div class="dropdown-menu dropdown-menu-animated" aria-labelledby="categoryDropdownMenuLink"style="left: -50px !important;">
                <router-link class="dropdown-item" to="/direcciones_cliente" >Direcciones</router-link>
                <!-- <a class="dropdown-item" href="category-right.html">Category - right sidebar   </a>-->
                <a class="dropdown-item" v-on:click="logout()">Cerrar sesiÃ³n</a>
              </div>
              </a>
            <div
              class="hambruger-button w-nav-button"
              style="-webkit-user-select: text"
              aria-label="menu"
              role="button"
              tabindex="0"
              aria-controls="w-nav-overlay-0"
              aria-haspopup="menu"
              aria-expanded="false"
            >
              <div
                data-w-id="4727fd08-6278-10ad-6fb9-1649612f1ccf"
                class="hamburger-bars"
              >
                <div class="menu-icon_line-top"></div>
                <div class="menu-icon_line-middle">
                  <div class="menu-icon_line-middle-inner"></div>
                </div>
                <div class="menu-icon_line-bottom"></div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <a
        href="#hero"
        class="back-top-top-icon-wrapper w-inline-block"
        style="
          transform: translate3d(0px, 17.67px, 0px) scale3d(1, 1, 1)
            rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg);
          transform-style: preserve-3d;
          will-change: opacity, transform;
          opacity: 1;
        "
      >
        <div class="back-top-top-icon">
          <img
            src="../assets/img/66cc3988e4a8cd40b9cf4c20_Frame.svg"
            loading="lazy"
            alt=""
            class="image-24px"
          />
        </div>
        <div
          class="percentage-color"
          style="
            will-change: transform;
            transform: translate3d(-100%, 0px, 0px) scale3d(1, 1, 1)
              rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg);
            transform-style: preserve-3d;
          "
        ></div>
      </a>
      <div class="w-nav-overlay" data-wf-ignore="" id="w-nav-overlay-0"></div>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
var currencyFormatter = require ('currency-formatter');

export default {
  name: "topHeader",
  data() {
    return {
      user: JSON.parse(this.$store.state.user),
      count_cart: 0,
      carrito: [],
      total: 0
    };
  },
  methods: {
    logout() {
      this.$store.dispatch("logout");
      if(this.$router.path !== '/') this.$router.push({ name: "home" });
      this.carrito = []
      this.count_cart = 0
      /*window.location.reload()*/ 
    },
    init_carrito() {
      if(this.$store.state.token != null){
        this.total = 0
        axios.get(this.$url + "/obtener_carrito", {
          headers: {
            "Content-Type": "application/json",
            Authorization: this.$store.state.token,
          },
        })
        .then((result) => {
          console.log(result.data.cart_general)
          for(var item of result.data.cart_general){
            let subtotal = item.producto.precio * item.cantidad
            this.total = this.total + subtotal 
          }
          this.count_cart = result.data.cart_general.length
          this.carrito = result.data.cart
        }); 
      }
    },
    convertCurrency(number){
          return currencyFormatter.format(number,{code:'MXN'})
    },
    
  },
  created(){
    this.sockets.subscribe('listen_cart', (data) => {
    this.init_carrito();
    this.user = JSON.parse(this.$store.state.user);
});
  },
  beforeMount() {
    this.init_carrito()
  },
};
</script>
